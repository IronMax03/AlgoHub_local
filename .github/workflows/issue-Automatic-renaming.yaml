name: Issue Automatic Renaming

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  rename-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Rename for New Algo Issues
        uses: actions/github-script@v7
        if: contains(github.event.issue.body, '### Algo_Name')
        with:
          script: |
            const issueBody = context.payload.issue.body;
            console.log("Issue Body:\n", issueBody);

            const match = /### Algo_Name\s*\n+(.+?)(\n+###|\n*$)/s.exec(issueBody);
            if (!match) {
              console.log("ğŸš« Could not find algo name in Markdown.");
              return;
            }

            const algoName = match[1].trim();
            const issueNumber = context.issue.number;
            const newTitle = `âœ¨ Implement ${algoName}`;

            console.log(`ğŸ”§ Updating issue title to: ${newTitle}`);

            await github.rest.issues.update({
              ...context.repo,
              issue_number: issueNumber,
              title: newTitle
            });

      - name: Rename for Bug Report Issues
        uses: actions/github-script@v7
        if: contains(github.event.issue.body, '### Severity')
        with:
          script: |
            const body = context.payload.issue.body;
            console.log("Issue Body:\n", body);

            const severityMatch = /### Severity\s+(.+?)\s*(###|$)/s.exec(body);
            const severity = severityMatch ? severityMatch[1].trim() : null;

            if (!severity) {
              console.log("ğŸš« Could not find severity in Markdown.");
              return;
            }

            const severityMap = {
              "ğŸ§® Algorithm Implementation": "ğŸ§®",
              "ğŸ›  CI/Tooling Issue": "ğŸ› ",
              "ğŸ“˜ Algorithm Documentation": "ğŸ“˜",
              "ğŸ–‹ General Documentation": "ğŸ–‹",
              "ğŸ§ª Test Failure or Adding Testcase": "ğŸ§ª",
              "â“ Other / Not Sure": "â“",
            };
            const severityIcon = severityMap[severity] || "â“";

            const rawTitle = context.payload.issue.title;
            if (rawTitle.startsWith("ğŸ”¥") || rawTitle.startsWith("ğŸ›‘") || rawTitle.startsWith("âš ï¸") || rawTitle.startsWith("â“")) {
              console.log("âœ… Title already formatted correctly.");
              return;
            }

            const issueNumber = context.issue.number;
            const updatedTitle = `âš ï¸ - ${severityIcon} [Bug]: ${rawTitle}`;

            console.log(`ğŸ”§ Updating issue title to: ${updatedTitle}`);

            await github.rest.issues.update({
              ...context.repo,
              issue_number: issueNumber,
              title: updatedTitle
            });
